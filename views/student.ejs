<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Marksheet</title>
        <meta name="description" content="">
        <!-- 
    	Volton Template
    	http://www.templatemo.com/tm-441-volton
        -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
     

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/font-awesome.css">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/templatemo-style.css">
        <link rel="stylesheet" href="css/student.css">
        <script src="js/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        
        <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
       
        <script src="js/student.js"></script>
        <!------ Include the above in your HEAD tag ---------->
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    
        <div class="responsive-header visible-xs visible-sm">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="top-section">
                            <div class="profile-image">
                                <img src="img/profile.jpg" alt="Volton">
                            </div>
                            <div class="profile-content">
                                <h3 class="profile-title">Volton</h3>
                                <p class="profile-description">Asst. Professor</p>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="#" class="toggle-menu"><i class="fa fa-bars"></i></a>
                <div class="main-navigation responsive-menu">
                    <ul class="navigation">
                        <li><a href="#top"><i class="fa fa-home"></i>Home</a></li>
                        <li><a href="#about"><i class="fa fa-user"></i>Marks Gallery</a></li>
                        <li><a href="#projects"><i class="fa fa-newspaper-o"></i>Add or Edit </a></li>
                        <li><a href="#contact"><i class="fa fa-envelope"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- SIDEBAR -->
        <div class="sidebar-menu hidden-xs hidden-sm">
            <div class="top-section">
                <div class="profile-image">
                    <img src="img/profile.jpg" alt="Volton">
                </div>
                <h3 class="profile-title">Volton</h3>
                <p class="profile-description">Asst. Professor</p>
            </div> <!-- top-section -->
            <div class="main-navigation">
                <ul class="navigation">
                    <li><a href="#top"><i class="fa fa-globe"></i>Welcome</a></li>
                    <li><a href="#about"><i class="fa fa-paperclip"></i>Marksheet</a></li>
                    <li><a href="#projects"><i class="fa fa-pencil"></i>Edit Mark</a></li>
                    <li><a href="#contact"><i class="fa fa-link"></i>Logout</a></li>
                </ul>
            </div> <!-- .main-navigation -->
            <div class="social-icons">
                <ul>
                    <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                    <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                    <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                    <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                    <li><a href="#"><i class="fa fa-youtube"></i></a></li>
                    <li><a href="#"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div> <!-- .social-icons -->
        </div> <!-- .sidebar-menu -->
        

        <div class="banner-bg" id="top">
            <div class="banner-overlay"></div>
            <div class="welcome-text">
                <h2>Student Marksheet</h2>
                <h5>Add marks or view marksheet </h5>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="fluid-container">

                <div class="content-wrapper">
                
                  
                    
                    <!-- PROJECTS -->
                    <div class="page-section" id="about">
                    <div class="row">
                        <div class="col-md-12">
                            <h4 class="widget-title">MARKSHEET</h4>
                            <select id="course">
                               
                                <% for(var i = 0; i <= options.length-1; i++) { %>
                                  <option value='<%= options[i].course_id%>'><%= options[i].course_name %></option>
                                <% } %>
                            </select>
                        </div>
                    </div>

                    

                    <div class="row">
                        <div class="panel panel-primary filterable">
                            <div class="panel-heading">
                                <h3 class="panel-title">Users</h3>
                                <div class="pull-right">
                                    <button class="btn btn-default btn-xs btn-filter"><span class="glyphicon glyphicon-filter"></span> Filter</button>
                                </div>
                            </div>
                            
                            <table class="table">
                                <thead>
                                    <tr class="filters">
                                        <th><input type="text" class="form-control" placeholder="#" disabled></th>
                                        <th><input type="text" class="form-control" placeholder="First Name" disabled></th>
                                        <th><input type="number"  min="0" max="100" class="form-control" placeholder="Mark" disabled></th>
                                        <th><input type="text"  class="form-control" placeholder="Subject" disabled></th>
                                    </tr>
                                </thead>
                                <tbody id="dist">
                                   
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <hr>

                    <!-- CONTACT -->
                    <div class="page-section" id="projects">
                    <div class="row">
                        <div class="col-md-12">
                            <h4 class="widget-title">Enter Mark</h4>
                        </div>
                    </div>
                    <div class="row">
                        <!-- <form action="#" method="post" class="contact-form">
                            <fieldset class="col-md-4 col-sm-6">
                                <input type="text" id="your-name" placeholder="Your Name...">
                            </fieldset>
                            <fieldset class="col-md-4 col-sm-6">
                                <input type="email" id="email" placeholder="Your Email...">
                            </fieldset>
                            <fieldset class="col-md-4 col-sm-12">
                                <input type="text" id="your-subject" placeholder="Subject...">
                            </fieldset>
                            <fieldset class="col-md-12 col-sm-12">
                                <textarea name="message" id="message" cols="30" rows="6" placeholder="Leave your message..."></textarea>
                            </fieldset>
                            <fieldset class="col-md-12 col-sm-12">
                                <input type="submit" class="button big default" value="Send Message">
                            </fieldset>
                        </form> -->
                        <form id="frm">
                            <div class="form-group">
                                <label for="subject"> Subject</label>
                                <select id="subject" name="subject" class="form-control" >
                                    <option value="0">Select subject...</option>
                                    <% for(var i = 0; i <= sub.length-1; i++) { %>
                                      <option value='<%= sub[i].course_id%>'><%= sub[i].course_name %></option>
                                    <% } %>
                                </select>
                              </div>
                            <div class="form-group">
                              <label for="nam"> Name<span id="err"></span></label>
                              <input type="text" class="form-control" name="nam" id="nam" placeholder="Enter  name">
                            </div>
                            <!-- <div class="form-group">
                                <label for="exampleInputName2">Last Name</label>
                                <input type="text" class="form-control" id="exampleInputName2" placeholder="Enter last name">
                            </div> -->
                            <div class="form-group">
                              <label for="mar">Mark (Out of 100)</label>
                              <input type="number" min="1" max="100" class="form-control" name="mar" id="mar" placeholder="Enter mark">
                            </div>
                            <!-- <div class="form-group">
                              <label for="exampleInputFile">File input</label>
                              <input type="file" id="exampleInputFile">
                              <p class="help-block">Example block-level help text here.</p>
                            </div> -->
                           
                            <button type="submit" id="createbtn" class="btn btn-primary">OK</button>
                          </form>
              
                    </div> <!-- .contact-form -->
                    </div>
                    <hr>

               
                        
                   
                   
                

                    <div class="row" id="footer">
                        <div class="col-md-12 text-center">
                            <p class="copyright-text">Copyright &copy; 2015 Company Name</p>
                        </div>
                    </div>

                </div>

            </div>
        </div>

        <script src="js/vendor/jquery-1.10.2.min.js"></script>
        <script src="js/min/plugins.min.js"></script>
        <script src="js/min/main.min.js"></script>
        <script typr="text/javascript">
         function load(id) {
             console.log(id)
             
             $.ajax({
              url: "http://localhost:3000/student/select/"+id,
        }).done(function (data) {
          var res = '';
          console.log(data, "acqired");
          $.each(data, function (i) {
            console.log(data[i], i, data[i].id,"hello");
            res =
              res +
              "<tr><td>" +
              data[i].id +
              "</td><td>" +
              data[i].name +
              "</td><td>" +
              data[i].mark +
              "</td><td>" +
              data[i].course_name +
              "</td>";
            
            res = res + "</tr>";
          });
          res = res + " ";
         
          $("#dist").html(res);
        });
      }

      function reload() {
             $.ajax({
              url: "http://localhost:3000/student/select/"
        }).done(function (data) {
          var res = "";
          console.log(data, "acqired");
          $.each(data, function (i) {
            console.log(data[i], i);
            res =
              res +
              "<tr><td>" +
              data[i].id +
              "</td><td>" +
              data[i].name +
              "</td><td>" +
              data[i].mark +
              "</td><td>" +
              data[i].course_name +
              "</td>";
           
            res = res + "</tr>";
          });
          res = res + "";
        
          $("#dist").html(res);
        });
      }

      function create(stud){
          let d={stud:stud,sub:$("#subject").val(),mar:$("#mar").val()};
        console.log("create");
        $.ajax({
          url: "http://localhost:3000/student/addmark",
          type:"POST",
          data: d,
        }).done(function (data) {
          if (data.status === "Valid"){
            console.log("Created row");
           // $("#nam").attr('disabled','disabled');// disable on select sub only
            $("#mar").attr('disabled','disabled');
            $("#nam").val("");
            $("#mar").val("");
            //All options should change to respective one
            load(d.sub);
            $("#createbtn").prop('disabled',true);
          } 
          //reload();
          console.log("Ajax post error on mark")
        });
      }

      $(document).ready(function(){
            reload();
            $("#err").html("");
            $("#nam").attr('disabled','disabled')
            $("#mar").attr('disabled','disabled')
            $("#createbtn").prop('disabled',true);
            $("#course").change(function(){
                console.log($("#course").val());
                if(Number($("#course").val())!==0){
                    load($("#course").val());
                }
                else{
                    reload();
                }
               
            });
            $("#subject").change(function(){
                console.log($("#subject").val());
                let id=Number($("#subject").val());
                if(id!==0){
                    $("#nam").removeAttr('disabled');
                    $("#nam").blur(function(){
                        var data={id:id,name:$("#nam").val()};
                        $.ajax({
                           url: "http://localhost:3000/student/checkstud",
                           data:data
                        }).done(function (data) {
                            console.log(data)
                         if (data.status === "Valid"){
                             console.log("Student present");
                             $("#mar").removeAttr('disabled');
                             $("#err").html(" ");
                             $("#createbtn").prop('disabled',false);
                             let sn=data.datid;
                             console.log(sn);
                             $("#frm").submit(function(e){
                                 //ajax call on submit
                               e.preventDefault();
                               create(sn);
                             })
                            
                           } 
                         else  {
                             $("#err").html("No student present");
                         }
                      });
                    })
                  
                }
                else{
                    $("#nam").attr('disabled','disabled');
                    $("#mar").attr('disabled','disabled');
                }
               
            });
      })
        </script>

    </body>
</html>